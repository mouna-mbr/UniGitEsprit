<div class="app-container" *ngIf="isLoaded">
  <div class="content">
    <div class="content-header">
      <div class="page-info">
        <div class="breadcrumb">
          <a href="/sujets" class="breadcrumb-link">
            <i class="fas fa-book"></i>
            Sujets
          </a>
          <i class="fas fa-chevron-right breadcrumb-separator"></i>
          <span class="breadcrumb-current">Ajouter un Sujet</span>
        </div>
        <h1>Ajouter un Nouveau Sujet</h1>
        <p class="subtitle">Créer un nouveau sujet</p>
      </div>
    </div>

    <div class="form-container">
      <form [formGroup]="sujetForm" (ngSubmit)="onSubmit()" class="add-class-form">
        <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <i class="fas fa-book"></i>
            </div>
            <div class="section-info">
              <h3>Informations du Sujet</h3>
              <p>Détails généraux du sujet</p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="titre" class="form-label">
                <i class="fas fa-tag"></i>
                Titre *
              </label>
              <input
                type="text"
                id="titre"
                formControlName="titre"
                class="form-input"
                placeholder="Entrez le titre du sujet"
                [class.error]="sujetForm.get('titre')?.invalid && sujetForm.get('titre')?.touched"
              >
              <div class="error-message" *ngIf="sujetForm.get('titre')?.invalid && sujetForm.get('titre')?.touched">
                Le titre est requis
              </div>
            </div>

            <div class="form-group">
              <label for="description" class="form-label">
                <i class="fas fa-align-left"></i>
                Description
              </label>
              <textarea
                id="description"
                formControlName="description"
                class="form-textarea"
                placeholder="Entrez la description du sujet"
                rows="5"
              ></textarea>
            </div>
          </div>
        
          <div class="form-group">
            <label class="form-label">Technologies</label>

            <div class="chips-container">
              <span *ngFor="let tech of selectedTechnologies" class="chip">
                {{ tech }}
                <button type="button" class="remove-btn" (click)="removeTechnology(tech)">×</button>
              </span>
            </div>

            <div class="autocomplete-container">
              <input
                type="text"
                class="form-textarea"
                placeholder="Tapez pour rechercher des technologies..."
                [formControl]="techControl"
                (keydown.enter)="addTechnology(techControl.value || '')"
              />

              <ul class="autocomplete-list" *ngIf="(filteredTechnologies | async)?.length && techControl.value">
                <li
                  *ngFor="let tech of (filteredTechnologies | async)"
                  (click)="addTechnology(tech)"
                  class="autocomplete-item"
                >
                  {{ tech }}
                </li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="goBack()">
            <i class="fas fa-arrow-left"></i>
            Retour
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="sujetForm.invalid">
            <i class="fas fa-plus"></i>
            Ajouter le Sujet
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="notification-container"></div>
</div>