<div class="app-container" *ngIf="isLoaded">
  <div class="content">
    <div class="content-header">
      <div class="page-info">
        <div class="breadcrumb">
          <a href="/sujets" class="breadcrumb-link">
            <i class="fas fa-book"></i>
            Sujets
          </a>
          <i class="fas fa-chevron-right breadcrumb-separator"></i>
          <span class="breadcrumb-current">Add Sujet</span>
        </div>
        <h1>Add New Sujet</h1>
        <p class="subtitle">Create a new sujet</p>
      </div>
    </div>

    <div class="form-container">
      <form [formGroup]="sujetForm" (ngSubmit)="onSubmit()" class="add-class-form">
        <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <i class="fas fa-book"></i>
            </div>
            <div class="section-info">
              <h3>Sujet Information</h3>
              <p>General details of the sujet</p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="titre" class="form-label">
                <i class="fas fa-tag"></i>
                Titre *
              </label>
              <input
                type="text"
                id="titre"
                formControlName="titre"
                class="form-input"
                placeholder="Enter sujet title"
                [class.error]="sujetForm.get('titre')?.invalid && sujetForm.get('titre')?.touched"
              >
              <div class="error-message" *ngIf="sujetForm.get('titre')?.invalid && sujetForm.get('titre')?.touched">
                Titre is required
              </div>
            </div>

            <div class="form-group">
              <label for="description" class="form-label">
                <i class="fas fa-align-left"></i>
                Description
              </label>
              <textarea
                id="description"
                formControlName="description"
                class="form-textarea"
                placeholder="Enter sujet description"
                rows="5"
              ></textarea>
            </div>
          </div>
        
<!-- Technologies Section -->
<div class="form-group">
  <label class="form-label">Technologies</label>

  <!-- ✅ Chips: show selected technologies -->
  <!-- Each selected technology appears as a blue "chip" with a small remove (×) button -->
  <div class="chips-container">
    <span *ngFor="let tech of selectedTechnologies" class="chip">
      {{ tech }}
      <!-- When clicking ×, the technology is removed from selectedTechnologies -->
      <button type="button" class="remove-btn" (click)="removeTechnology(tech)">×</button>
    </span>
  </div>

  <!-- ✅ Input + Dropdown for technology search -->
  <div class="autocomplete-container">
    <!-- Input connected to the FormControl 'techControl' -->
    <!-- As user types, filteredTechnologies updates automatically via valueChanges -->
    <!-- Pressing Enter adds the technology manually -->
    <input
      type="text"
      class="form-textarea"
      placeholder="Type to search technologies..."
      [formControl]="techControl"
      (keydown.enter)="addTechnology(techControl.value || '')"
    />

    <!-- ✅ Dropdown (appears only if there are matching results AND the user typed something) -->
    <!-- Each <li> shows a suggestion from filteredTechnologies -->
    <!-- Clicking a suggestion calls addTechnology(tech) -->
    <ul class="autocomplete-list" *ngIf="(filteredTechnologies | async)?.length && techControl.value">
      <li
        *ngFor="let tech of (filteredTechnologies | async)"
        (click)="addTechnology(tech)"
        class="autocomplete-item"
      >
        {{ tech }}
      </li>
    </ul>
  </div>
</div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="goBack()">
            <i class="fas fa-arrow-left"></i>
            Back
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="sujetForm.invalid">
            <i class="fas fa-plus"></i>
            Add Sujet
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="notification-container"></div>
</div>