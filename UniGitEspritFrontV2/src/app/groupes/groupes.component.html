<!-- Groups Content -->
<main class="groups-main">
  <!-- Action Bar -->
  <div class="action-bar">
    <div class="page-title">
      <h1 style="margin-bottom:10px">Groupes</h1>
      <div style="display: flex; justify-content: space-between; margin-bottom:20px"> 
        <div><p class="subtitle">Manage your student groups</p></div>
        <div class="action-buttons">
          <button class="btn btn-secondary">
            <i class="fas fa-filter"></i>
            Filter
          </button>
          <button class="btn btn-primary" (click)="addGroup()">
            <i class="fas fa-plus"></i>
            Add Group
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Groups Grid -->
  <div class="groups-grid">
    <ng-container *ngFor="let group of groups">
      <div class="group-card" [class.favorite]="isFavorite(group.id)">
        <div class="card-header">
          <div class="card-gradient"></div>
          <div class="card-icon">
            <!-- You can make this dynamic based on group.sujetId or nom -->
            <i class="fas fa-users"></i>
          </div>

          <div class="card-menu-container">
            <button class="card-menu" (click)="toggleMenu(group.id, $event)">
              <i class="fas fa-ellipsis-h"></i>
            </button>

            <div class="dropdown-menu" [class.show]="isMenuOpen(group.id)">
              <div class="menu-item" (click)="toggleFavorite(group.id, $event)">
                <i [class]="isFavorite(group.id) ? 'fas fa-heart-broken' : 'fas fa-heart'"></i>
                <span class="favorite-text">
                  {{ isFavorite(group.id) ? 'Retirer des favoris' : 'Ajouter aux favoris' }}
                </span>
              </div>

              <div class="menu-item" (click)="editGroup(group.id, $event)">
                <i class="fas fa-edit"></i>
                <span>Modifier</span>
              </div>

              <div class="menu-item" (click)="shareGroup(group.id, $event)">
                <i class="fas fa-share"></i>
                <span>Partager</span>
              </div>

              <div class="menu-item danger" (click)="deleteGroup(group.id, $event)">
                <i class="fas fa-trash"></i>
                <span>Supprimer</span>
              </div>
            </div>
          </div>

          <div class="favorite-badge" *ngIf="isFavorite(group.id)">
            <i class="fas fa-heart"></i>
          </div>
        </div>

        <div class="card-content">
          <h3 class="group-name">{{ group.nom }}</h3>
          <p class="group-class">Classe ID: {{ group.classeId }}</p>

          <div class="group-stats">
            <div class="stat">
              <i class="fas fa-user"></i>
              <!-- CORRECTION : Utilisation de group.members au lieu de group.memberEmails -->
              <span>{{ (group.members || []).length }} membres</span>
            </div>
            <div class="stat">
              <i class="fas fa-project-diagram"></i>
              <span>Sujet ID: {{ group.sujetId }}</span>
            </div>
            <div class="stat" *ngIf="group.gitRepoUrl">
              <i class="fas fa-link"></i>
              <a [href]="group.gitRepoUrl" target="_blank" class="repo-link">Voir le repo</a>
            </div>
            <div class="stat" *ngIf="!group.gitRepoUrl">
              <i class="fas fa-unlink"></i>
              <span class="no-repo">Aucun repo</span>
            </div>
          </div>
        </div>

        <div class="card-footer">
          <button class="btn-consult" (click)="viewGroup(group.id)">
            <span>Voir</span>
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <button class="pagination-btn" disabled>
      <i class="fas fa-chevron-left"></i>
    </button>
    <span class="pagination-info">Page 1 of 3</span>
    <button class="pagination-btn">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</main>